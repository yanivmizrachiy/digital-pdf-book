<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ“š ×¡×¤×¨×™×™×” ×“×™×’×™×˜×œ×™×ª (PDF)</title>
  <style>
    :root{--bg:#0b0f19;--text:#e5e7eb;--muted:#9ca3af;--accent:#60a5fa;--shadow:0 18px 45px rgba(0,0,0,.35);--r:18px;--font:system-ui,-apple-system,"Segoe UI","Heebo","Assistant",Arial,sans-serif;}
    *{box-sizing:border-box}
    body{margin:0;font-family:var(--font);color:var(--text);
      background:radial-gradient(1200px 600px at 70% 0%, rgba(96,165,250,.20), transparent 60%),
                 radial-gradient(900px 500px at 10% 20%, rgba(52,211,153,.18), transparent 55%),
                 linear-gradient(180deg,#05070d 0%, var(--bg) 65%, #070b14 100%);
      min-height:100vh;}
    header{max-width:1100px;margin:0 auto;padding:28px 18px 14px;display:flex;gap:16px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
    h1{margin:0;font-size:26px}
    .sub{margin:6px 0 0;color:var(--muted);font-size:14px;line-height:1.4}
    .btn{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);color:var(--text);padding:10px 12px;border-radius:12px;text-decoration:none;display:inline-flex;gap:8px;align-items:center}
    main{max-width:1100px;margin:0 auto;padding:0 18px 34px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:var(--r);box-shadow:var(--shadow);overflow:hidden}
    .toolbar{padding:14px;border-bottom:1px solid rgba(255,255,255,.08);
      background:linear-gradient(180deg, rgba(96,165,250,.10), rgba(255,255,255,.02));
      display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .search{flex:1;min-width:220px;display:flex;gap:10px;align-items:center;background:rgba(0,0,0,.25);border:1px solid rgba(255,255,255,.10);border-radius:14px;padding:10px 12px}
    .search input{width:100%;background:transparent;border:none;color:var(--text);font-size:15px;outline:none}
    .pill{font-size:12px;color:var(--muted);padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.15)}
    .chips{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .chip{border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.20);color:var(--text);padding:8px 10px;border-radius:999px;cursor:pointer;font-size:13px}
    .chipOn{border-color:rgba(96,165,250,.45);box-shadow:0 0 0 3px rgba(96,165,250,.18)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:14px;padding:14px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.09);border-radius:16px;overflow:hidden}
    .card a{display:flex;gap:12px;padding:14px;text-decoration:none;color:inherit}
    .cover{width:64px;height:86px;border-radius:12px;overflow:hidden;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.22);flex:0 0 auto;display:flex;align-items:center;justify-content:center}
    .cover img{width:100%;height:100%;object-fit:cover;display:block}
    .coverFallbackInner{font-weight:800;letter-spacing:.8px;opacity:.85}
    .title{margin:0 0 6px;font-size:16px;line-height:1.25}
    .meta{margin:0;color:var(--muted);font-size:13px;line-height:1.35}
    .tagrow{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .tag{font-size:12px;padding:5px 9px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);color:#d1d5db}
    .empty{padding:26px 14px;color:var(--muted);text-align:center}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
  </style>
</head>
<body>
  <header>
    <div>
      <h1>ğŸ“š ×¡×¤×¨×™×™×” ×“×™×’×™×˜×œ×™×ª (PDF)</h1>
      <p class="sub">×›×¤×ª×•×¨ ×œ×›×œ ×§×•×‘×¥ â€¢ ×¦×¤×™×™×” ×¢× ×“×¤×“×•×£ â€¢ ××ª×¢×“×›×Ÿ ××•×˜×•××˜×™×ª ×œ×¤×™ <code>books/</code></p>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <a class="btn" href="viewer.html">×¦×•×¤×”</a>
      <a class="btn" href="https://github.com/" target="_blank" rel="noreferrer">GitHub</a>
    </div>
  </header>

  <main>
    <section class="panel">
      <div class="toolbar">
        <div class="chips" id="tagWrap"></div>
        <div class="search">ğŸ” <input id="q" type="search" placeholder="×—×¤×© ×¡×¤×¨ (×©× / ×›×™×ª×” / × ×•×©×)..." autocomplete="off"></div>
        <span class="pill" id="countPill">×˜×•×¢×Ÿâ€¦</span>
        <span class="pill" id="updatedPill">â€”</span>
      </div>

      <div class="grid" id="grid"></div>
      <div class="empty" id="empty" style="display:none;">
        ××™×Ÿ ×¢×“×™×™×Ÿ ×¡×¤×¨×™×. ×”×•×¡×£ ×§×•×‘×¦×™ PDF ×œ×ª×™×§×™×™×ª <code>books/</code> ×•×‘×¦×¢ push.
      </div>
    </section>
  </main>

<script>
  const grid = document.getElementById('grid');
  const empty = document.getElementById('empty');
  const q = document.getElementById('q');
  const countPill = document.getElementById('countPill');
  const updatedPill = document.getElementById('updatedPill');
  let books = [];
  let activeTag = "×”×›×œ";

  const norm = s => (s||"").toString().trim().toLowerCase();
  const uniq = arr => Array.from(new Set(arr.filter(Boolean)));

  function coverPath(file){
    const base = file.split("/").pop().replace(/\.pdf$/i,"");
    return `thumbs/${base}.png`; // ×× ××™×Ÿ â€” ×™×™×¤×•×œ ×œ-fallback
  }

  function bookMatches(b, term){
    if(!term) return true;
    const hay = [b.title,b.file,b.grade,(b.tags||[]).join(" ")].map(norm).join(" | ");
    return hay.includes(term);
  }

  function buildTags(){
    const tags = uniq(books.flatMap(b => (b.tags||[])));
    const wrap = document.getElementById("tagWrap");
    wrap.innerHTML = "";
    for(const t of ["×”×›×œ", ...tags]){
      const btn = document.createElement("button");
      btn.className = "chip" + (t===activeTag ? " chipOn" : "");
      btn.textContent = t;
      btn.onclick = ()=>{ activeTag = t; buildTags(); render(); };
      wrap.appendChild(btn);
    }
  }

  function inActiveTag(b){
    return activeTag==="×”×›×œ" || (b.tags||[]).includes(activeTag);
  }

  function render(){
    const term = norm(q.value);
    const filtered = books.filter(inActiveTag).filter(b=>bookMatches(b,term))
      .sort((a,b)=> (a.title||a.file).localeCompare((b.title||b.file),"he"));

    grid.innerHTML = "";
    if(filtered.length === 0){
      empty.style.display = "block";
      countPill.textContent = books.length ? "0 ×ª×•×¦××•×ª" : "0 ×¡×¤×¨×™×";
      return;
    }
    empty.style.display = "none";
    countPill.textContent = `${filtered.length} ×¡×¤×¨×™×`;

    for(const b of filtered){
      const href = `viewer.html?file=${encodeURIComponent(b.file)}&title=${encodeURIComponent(b.title||"")}`;
      const c = coverPath(b.file);
      const grade = b.grade ? `×›×™×ª×”: ${b.grade} â€¢ ` : "";
      const tagsHtml = (b.tags && b.tags.length) ? `<div class="tagrow">${b.tags.map(t=>`<span class="tag">${t}</span>`).join("")}</div>` : "";
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <a href="${href}">
          <div class="cover">
            <img src="${c}" alt="" loading="lazy"
              onerror="this.style.display='none'; this.parentElement.innerHTML='<div class=&quot;coverFallbackInner&quot;>PDF</div>';">
          </div>
          <div style="flex:1;min-width:0">
            <h3 class="title">${b.title || b.file}</h3>
            <p class="meta">${grade}${b.file}</p>
            ${tagsHtml}
          </div>
        </a>`;
      grid.appendChild(card);
    }
  }

  async function load(){
    try{
      const res = await fetch("data/books.json?ts="+Date.now(), {cache:"no-store"});
      if(!res.ok) throw new Error("HTTP "+res.status);
      const data = await res.json();
      books = Array.isArray(data.books) ? data.books : [];
      updatedPill.textContent = data.generated_at ? ("×¢×•×“×›×Ÿ: "+data.generated_at) : "×¢×•×“×›×Ÿ";
      buildTags(); render();
    }catch(e){
      books = [];
      updatedPill.textContent = "×œ× × ×˜×¢×Ÿ (books.json)";
      buildTags(); render();
    }
  }

  q.addEventListener("input", render);
  load();

  if("serviceWorker" in navigator){
    addEventListener("load", ()=> navigator.serviceWorker.register("./sw.js").catch(()=>{}));
  }
</script>
</body>
</html>
